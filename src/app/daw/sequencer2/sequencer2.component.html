<div class="card">
  <div class="card-body">
    <div *ngIf="pattern" [ngStyle]="{'margin-left':cells[0]?.width+'px'}">
      <div class="cell" [ngStyle]="{
          'left':-cells[0]?.width+'px',
          'top':0,
          'width':cells[0]?.width+'px',
          'height':cells[0]?.height+'px',
          'line-height':cells[0]?.height+'px'}">
        <button type="button"
                (click)="toggleClip()"
                class="btn btn-primary btn-block toggle-button rounded-0 h-100">
          <i class="fas fa-play-circle fa-2x" *ngIf="!clipIsRunning()"></i>
          <i class="fas fa-circle-notch fa-spin fa-2x" *ngIf="clipIsRunning()"></i>
        </button>
      </div>

      <div class="cell"
           *ngFor="let cell of cells"
           [attr.data-id]="cell.id"
           (click)="onCellClicked(cell)"

           jquery-draggable
           [dragEnabled]="cell.data && cell.row>=0 && cell.column>=0 && !isResizing && pattern.quantizationEnabled.getValue()===false"
           (jqDragStart)="dragStart()"
           (jqDragEnd)="dragEnd($event)"
           [draggedCell]="cell"

           [draggable]="cell.data && cell.row>=0 && cell.column>=0 && pattern.quantizationEnabled.getValue()"
           (dragstart)="dragHandler.onDragStart($event,cell)"
           (dragover)="dragHandler.onDragOver($event)"
           (dragleave)="dragHandler.onDragLeave($event)"
           (drag)="dragHandler.onDrag($event)"
           (dragend)="dragHandler.onDragEnd($event)"
           (drop)="dragHandler.onDrop($event)"

           interact-resizable
           (resizeStart)="resizeStart()"
           (resizeEnd)="resizeEnd($event)"
           [enabled]="cell.column>=0 && cell.row>=0 && cell.data!=null"
           parent=".sequencer-container"

           [ngClass]="{
           'header-cell':cell.row===-1,
           'row-header-cell':cell.column===-1,
           'event-cell':cell.data,
           'tick-active':cell.tick === tick &&clipIsRunning(),
           'note-cell':cell.row>=0 && cell.column>=0}"

           [ngStyle]="{'left':cell.x+'px','top':cell.y+'px','width':cell.width+'px',
           'height':cell.height+'px','line-height':cell.height+'px'}">

        <span *ngIf="cell.row===-1" class="">{{cell.beat + 1 != 0 ? cell.beat + 1 : ""}}</span>
        <span *ngIf="cell.column===-1" class="">{{cell.note}}</span>
      </div>
    </div>
    <!--
            class="sequencer-container"
    -->
  </div>
  <div class="card-footer">
    <quantization [quantization]="pattern.quantization.getValue()"
                  (quantizationChanged)="changeQuantization($event)"></quantization>
    <button type="button"
            (click)="pattern.quantizationEnabled.next(!pattern.quantizationEnabled.getValue())"
            [ngClass]="{'active':pattern.quantizationEnabled.getValue()}"
            class="btn btn-secondary">
      Q
    </button>
    <button type="button" class="btn record-btn" (click)="toggleRecord()">REC</button>
  </div>
</div>






